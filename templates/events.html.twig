{% extends 'base.html.twig' %}

{% block title %}Evenements{% endblock %}

{% block titre %}Evenements{% endblock %}

{% block body %}
<div class="row">
    <div class="col">
        <a class="btn btn-primary" href="{{ path('event_add') }}" role="button">ajout</a>
    </div>
</div>
<div class="row">
    <div class="col">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Event</th>
                    <th>Location</th>
                    <th>Date</th>
                    <th>Frais</th>
                    <th>Chiffres</th>
                    <th>C.A</th>
                </tr>
            </thead>
            <tbody>
            {% for event in events %}
                <tr>
                    <td><a href="{{ path('event_view',{id:event.id}) }}">{{event.id}}</a></td>
                    <td>{{event.name}}</td>
                    <td>{{event.location}}</td>
                    <td>{{event.date|date("d/m/Y")}}</td>
                    <td>
                        {% set feesValue = "0" %}
                        {% for fees in event.fees %}
                           {% set feesValue = feesValue+ fees.price %} 
                        {% endfor %}
                        {{feesValue}} €
                    </td>
                    <td>
                        {% set invoiceCompute = "0" %}
                        {% for invoice in event.invoices %}
                           {% for line in invoice.invoiceLines %}
                                {% set invoiceCompute = invoiceCompute + (line.quantity*line.price - ((line.quantity*line.price*line.discount)/100)) %}
                           {% endfor %}
                        {% endfor %}
                        {{invoiceCompute}} €
                    </td>
                    <td> {% set ca = invoiceCompute - feesValue %}
                    {{ca}} €</td>
                </tr>    
            {% endfor %}
        </table>    

    </div>
</div>
{% endblock %}
